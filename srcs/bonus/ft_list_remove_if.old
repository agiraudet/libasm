section	.text
	global	ft_list_remove_if
	extern	free

ft_list_remove_if:
	mov		r12, rdi		;original pointer
	mov		r13, rsi		;data ref
	xor		r14d, r14d
	mov		r15, rcx
	mov		rdi, [rdi]		;current elem

.loop:
	call	.cmpr
	test	al, al
	je		.del
	test	rsi, rsi
	je		.exit
	mov		r14, rdi
	mov		rdi, rsi
	jmp		.loop

.cmpr:
	push	rdi
	push	rsi
	mov		rdi, [rdi]
	mov		rsi, r13
	xor		eax, eax
	call	rdx
	pop		rsi
	pop		rdi
	mov		rsi, [rdi + 8]
	ret

.del:
	push	rdi
	mov		rdi, [rdi]
	call	r15
	pop		rdi
	call	free
	mov		rdi, rsi
	test	rdi, rdi
	je		.exit
	test	r14, r14
	jne		.setprev
	je		.setpoint

.setprev:
	mov		[r14 + 8], rsi
	jmp		.loop

.setpoint:
	mov		[r12], rsi
	mov		rdi, rsi
	jmp		.loop

.exit:
	ret
